<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org.//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="adminMapper">

    <delete id="userDeleteAll">
        DELETE FROM USER
    </delete>

    <delete id="userDelete" parameterType="String">
        DELETE FROM USER WHERE user_id = #{user_id}
    </delete>

    <delete id="deleteNotice" parameterType="int">
        DELETE FROM NOTICE WHERE notice_seq = #{notice_seq}
    </delete>

    <delete id="adminDelete" parameterType="String">
        DELETE FROM ADMIN WHERE admin_id = #{admin_id}
    </delete>

    <select id="agencyCnt" resultType="int" parameterType="String">
        SELECT
            count(*)
        FROM
            agency
        WHERE
            1=1
        <choose>
            <when test='option=="I"'>
                AND agency_id LIKE concat('%', #{keyword}, '%')
            </when>
            <when test='option=="N"'>
                AND agency_name LIKE concat('%', #{keyword}, '%')
            </when>
        </choose>
    </select>

    <select id="userCnt" resultType="int" parameterType="String">
        SELECT
            count(*)
        FROM
            user
        WHERE
            1=1
        <choose>
            <when test='option=="I"'>
                AND user_id LIKE concat('%', #{keyword}, '%')
            </when>
            <when test='option=="N"'>
                AND user_name LIKE concat('%', #{keyword}, '%')
            </when>
        </choose>
    </select>

    <select id="adminLogin" resultType="AdminDto" parameterType="Map">
        SELECT
            admin_id, admin_email, admin_password, admin_phone, admin_nickname, admin_use_yn, admin_reg_at, admin_auth, created_at, created_id, updated_at, updated_id
        FROM
            admin
        WHERE
            1=1
            and admin_id = #{admin_id}
            and admin_password = #{admin_password}
    </select>

    <select id="userStatics" resultType="UserDto">
        SELECT
            user_name, user_id, user_tel, user_email, user_address, user_gender , user_visit_cnt , user_birth , user_create_at
        FROM
            user
        ORDER BY
            user_create_at desc
        LIMIT
            3
    </select>

    <select id="userList" resultType="UserDto">
        SELECT
            *
        FROM
            user
        ORDER BY
            user_create_at desc
    </select>

    <select id="agencyPagingList" resultType="AgencyDto" parameterType="java.util.HashMap">
        SELECT
            *
        FROM
            agency
        WHERE
            1=1
        <choose>
            <when test='option=="I"'>
                AND agency_id LIKE concat('%', #{keyword}, '%')
            </when>
            <when test='option=="N"'>
                AND agency_name LIKE concat('%', #{keyword}, '%')
            </when>
        </choose>
        ORDER BY
            agency_reg_at desc
        limit
            #{start}, #{limit}
    </select>

    <select id="userPagingList" resultType="UserDto" parameterType="java.util.HashMap">
        SELECT
            *
        FROM
            user
        WHERE
            1=1
            <choose>
                <when test='option=="I"'>
                    AND user_id LIKE concat('%', #{keyword}, '%')
                </when>
                <when test='option=="N"'>
                    AND user_name LIKE concat('%', #{keyword}, '%')
                </when>
            </choose>
        ORDER BY
            user_create_at desc
        limit
	        #{start}, #{limit}
    </select>

    <update id="userRetireUpdate" parameterType="String">
        UPDATE user
        SET
            user_retire_yn = 'Y',
            user_retire_at = now()
        WHERE
            user_id = #{user_id};
    </update>

    <insert id="insertUser" parameterType="UserDto">
        insert into user
        (user_id,
         user_password,
         user_name,
         user_email,
         user_tel,
         user_address,
         user_nickname,
         user_birth,
         user_gender,
         user_create_at,
         user_retire_yn,
         user_visit_cnt,
         user_interested_genre,
         created_at,
         created_id,
         updated_at,
         updated_id)
        values
            (#{user_id},
             #{user_password},
             #{user_name},
             #{user_email},
             #{user_tel},
             #{user_address},
             #{user_nickname},
             #{user_birth},
             #{user_gender},
             current_timestamp,
             "N",
             0,
             #{user_interested_genre},
             current_timestamp,
             "JISOO",
             current_timestamp,
             "JISOO")
    </insert>

    <insert id="insertAdmin" parameterType="NoticeDto">
        INSERT INTO admin
        (admin_id, admin_email, admin_password, admin_phone, admin_nickname, admin_use_yn, admin_reg_at, admin_auth, created_at, created_id, updated_at, updated_id)
        VALUES(#{admin_id}, #{admin_email}, #{admin_password}, #{admin_phone}, #{admin_nickname}, "Y", CURRENT_TIMESTAMP, "S", CURRENT_TIMESTAMP, "JISOO", CURRENT_TIMESTAMP, "JISOO")
    </insert>

    <insert id="insertAgency" parameterType="AgencyDto">
        INSERT INTO agency
        (agency_id, agency_password, agency_name, agency_email, agency_tel, agency_register_num, agency_reg_at, agency_status_val, agency_contract_reg_at, agency_contract_expire_at, agency_content, agency_manager_name, created_at, created_id, updated_at, updated_id)
        VALUES(#{agency_id}, #{agency_password}, #{agency_name}, #{agency_email}, #{agency_tel}, #{agency_register_num}, CURRENT_TIMESTAMP, "R", CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, null, #{agency_manager_name} , CURRENT_TIMESTAMP, "JISOO", CURRENT_TIMESTAMP, "JISOO")
    </insert>

    <delete id="deleteAllAgency">
        delete from agency
    </delete>

    <select id="countAllAgency" resultType="int">
        select count(*) from agency
    </select>

    <select id="dupleAdminId" resultType="int" parameterType="String">
        SELECT count(*) FROM admin WHERE admin_id = #{admin_id}
    </select>

    <update id="updateAdminInfo" parameterType="AdminDto">
        update admin
        set
            admin_email = #{admin_email},
            admin_password = #{admin_password},
            admin_phone = #{admin_phone},
            admin_nickname = #{admin_nickname},
            admin_use_yn = 'Y',
            updated_at = now(),
            updated_id = "JISOO"
        where
            admin_id = #{admin_id}
    </update>

    <select id="showAdminInfo" parameterType="String" resultType="AdminDto">
        select * from admin where admin_id = #{admin_id}
    </select>
</mapper>
