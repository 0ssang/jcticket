## 예매 팝업창 - 설계 순서와 목적 (역순으로 요구사항 도출해볼것)
#### _step1. 일정선택  --> step2. 좌석선택 --> step3. 쿠폰선택 --> step4. 결제방법_

- - - 
- - -

### 1. mapper - sql
 - DAO 작성한 메서드를 기반으로 MySQL 쿼리를 작성한다.
#### step1. 일정선택
- 사용 테이블 : showing(회차), play(공연), stage(공연장)
#### step2. 좌석선택
- 사용 테이블 : stage, seat, show_seat, seat_class
- - - 
### 2. Dao / DaoImpl
     DB의 data에 접근하기 위한 객체   
     어플리케이션에서 사용할 DB로직을 객체 하나에 메서드로 구현함
     DB에 대한 단일 접근성 및 모듈화가 중요함
#### step1. 일정선택
* Service 즉 비즈니스 로직이 포함되지 않고 DB에 접근하여 데이터만 가져오자....
* 어떠한 것들이 있을끼? 기적으로 --> Service에서 이용할 수 있는 CRUD 기능이 존재해야 한다.
* CREATE
     + 일정 선택 로직에서는 필요가 없다. 그러나 Test 코드 작성을 위해 형식적으로 만들자
     + insert 쿼리로 회차 DTO를 사용해 DB에 저장한다.
* READ
    + 공연아이디별 회차테이블의 리스트를 List<ShowingDto> 형식으로 가져온다.
    + 공연아이디별 공연명, 공연장명을 HashMap<>으로 가져온다.
    + 공연아이디별 공연일정 리스트를 받아온다.
    + 공연아이디, 공연일정별로, 회차시퀀스, 회차정보를 리스트를 받아온다.
    + 회차시퀀스에 따른 좌석정보를 회차-좌석 테이블에서 가져온다.
    + 공연아이디별 회차 수 카운팅.
* UPDATE
    + 일정 선택에서는 구현하지 않는다.
* DELETE
    + 마찬가지로 일정 선택 팝업창에서 삭제 쿼리는 필요하지 않지만 Test코드 작성을 위해 만들자.
    + delete 쿼리로 회차 테이블의 데이터를 모두 삭제한다.
    + 공연아이디 별 로우를 삭제한다
    + 회차 시퀀스별 로우를 삭제한다.
#### step2. 좌석선택
* CREATE
  + Test 코드 작성을 위해 만들자
  + 회차-좌석 테이블의 DTO를 이용하여 insert
  + 좌석 테이블의 DTO를 이용하여 insert
* READ
  + 
* UPDATE
* DELETE
- - -
### 3. Service / ServiceImpl
        사용자의 요청(request)에 대해 어떤 처리를 할지 결정하는 파트 
        즉, Controller가 받은 요청에 대해 알맞는 정보를 가공해서 다시 Controller에게 데이터를 넘기는 것
        하나의 서비스를 위해 여러개의 DAO를 묶은 트랜잭션이 생성되고, Service는 곧 트랜잭션의 단위가 된다.
        로직을 서비스에 담는 이유는, 비슷한 처리를 서로 다른 페이지에서 요청한다면 각각의 컨트롤러에 중복코드가 발생하지않을까? 그걸 해결하기 위함이다.
#### step1. 일정선택
   * 공연명, 공연표지, 공연일자, 공연장명을 가져와서 **Map<String,Object(list)>** 로 반환한다.
      + 공연명, 공연표지 --> 공연테이블에서 가져온다.
      + 공연일자 --> 회차 테이블에서 가져온다.
      + 공연장명 --> 공연장 테이블에서 가져온다.
   * 공연일자에 따른 회차정보를 가져와야 한다. **List<(String)>** 형태로 회차들을 반환한다.
      + 회차정보 --> 회차 테이블에서 가져온다.
      + 좌석정보 --> 회차-좌석 테이블에서 가져온다.
#### step2. 좌석선택
* 좌석테이블과 공연좌석 테이블의 차이가 뭘까? 이해가 잘 되지 않는다..... 왜 일까???
    + 회차와 공연테이블의 관계를 대입해보자.
    + 키를소유하고 데이터를 중복으로 많이 가지고 있는 테이블 == 공연좌석, 회차
    + 키를 제공하고 데아터를 중복으로 가지고 있지 않는 테이블 == 좌석, 공연
    + 최차테이블에서 공연 아이디를 기준으로 공연명을 가져왔듯이
    + 공연좌석테이블에서 좌석 시퀀스를 기준으로 좌석아이디를 가져온다....?
* 가져와야 할 데이터 : 회차시퀀스, 좌석상태, 좌석리스트  
* 공연아이디, 공연일정, 회차정보를 가지고 회차 시퀀스를 구한다.
* 회차 시퀀스와 좌석아이디를 가지고 좌석 상태를 조회한다 (단일 값) ==> show_seat 테이블
* 회차 시퀀스와 좌석아이디를 가지고 좌석 상태를 N or Y로 업데이트한다 ==> show_seat 테이블
* 회차 시퀀스와 좌석상태가 Y인 좌석 아이디 리스트를 반환한다. ==> show_seat 테이블
* 회차 시퀀스와 좌석가격과 좌석상태가 Y인 좌석의 개수를 카운팅한다. ==> seat_class, show_seat 테이블
* 회차 시퀀스와 좌석가격과 좌성상태가 Y안 좌석의 개수를 곱하여 선택가격을 만들어 변환한다. ==> seat_class, show_seat 테이블
- - -
### 4. Controller
        사용자의 요청(request)을 어떻게 처리할지 결정하는 파트 --> parameter가 넘어온다.
#### step1. 일정선택
* 공연 상세페이지에서 예매하기 버튼을 누르면 예매 팝업창을 띄워준다.
   + 공연명, 공연일자, 공연포스터, 공연장명 데이터 필요로 함
* 캘린더의 날짜를 클릭 했을 떼 ajax를 이용하여 회차 데이터를 가져와야 한다.
    + 공연일에 따른 공연회차 데이터 필요로 함
* 회차에 따라 남은 잔여좌석수 정보를 구해야 한다.

* 컨트롤러에서 서비스로 넘겨줄 객체를 만들자... 일정 선택에서 필요한 정보는
     + 공연아이디, 공연일자, 공연회차, 공연 시퀀스? ....--> 더 생각해 봐야 한다.
#### step2. 좌석선택
* ajax를 통해 받아온 회차시퀀스를 가지고 좌석아이디, 좌석상태 데이터를 가져온다.
* 회차테이블에서 회차좌석가격 컬럼을 가져온다. --> ajax(post 요청) : 매개변수 --> 회차시퀀스
* 업데이트는 이 단에서 하지 않는다. >> 결제가 완료되어야 실제 DB에 Update 쿼리가 날라간다.
* 그 전까지는 JS단에서 배열에 담아 관리한다. 

- - - 
### 5. View - jsp, js, css
#### step1. 일정선택
* 기본적으로 공연명, 공연일자, 공연표지 정보를 받아와서 표시 해놓아야 한다.
* datepicker를 사용하여 캘린더를 배치한다.
* 캘린더에는 선택된 공연의 공연날짜까 표시되어있어야 한다.
* 캘린더에서 공연 일정을 선택하면 해당 날짜의 회차정보가 공연일에 따라 다르게 보여진다.
* 회차 정보를 선택하면 잔여석 정보가 표시되고 다음단계 버튼이 활성화된다.

#### step2. 좌석선택
* 컨트롤러로부터 좌석아이디, 좌석상태, 회차좌석가격 정보를 받아온다.
* 좌석아이디, 좌석상태를 기준으로 활성화(클릭가능), 비활성화한다.
  + 좌석상태가 'Y'이면 ==> 클릭 비활성화  /  좌석상태가 'N이면' ==> 활성화
* 고객이 좌석을 클릭하면 해당 좌석이 체크되고 해당좌석ID와 가격정보가 우측 패널에 표시된다,
    + 좌석을 클릭하면 JS 단에서 해당 박스의 아이디를 선택한 좌석 리스트에 추가한다.
    + 선택된 좌석 배열을 우측 패널에 표시한다.
* 회차테이블의 회차좌석가격을 가져와서 (리스트의 사이즈 x 회차좌석가격) 출력한다.
* '다음단계' 버튼을 누르면 선택된 선택한 좌석ID List 와 가격정보를 가지고 다음단계로 넘어간다.
- - - 